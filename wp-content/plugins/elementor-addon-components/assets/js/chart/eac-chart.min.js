(function(a){"use strict";window.eacWidgetChart=function(b){function c(){Chart.plugins.unregister(ChartDataLabels);var b=navigator.userAgent.toLowerCase().indexOf("firefox");isMobile()&&-1!==b&&(q.options.plugins.style=!1),Chart.defaults.global.defaultFontSize=P,""!==U&&a.extend(q.options.scales.xAxes[0].scaleLabel,{display:!0,labelString:U,fontColor:W}),1==D&&a.extend(q.options.scales.xAxes[0],{gridLines:{display:!0,color:X}}),a.extend(q.options.scales.xAxes[0].ticks,{fontColor:W}),""!==V&&a.extend(q.options.scales.yAxes[0].scaleLabel,{display:!0,labelString:V,fontColor:W}),1==E&&a.extend(q.options.scales.yAxes[0],{gridLines:{display:!0,color:X}}),a.extend(q.options.scales.yAxes[0].ticks,{fontColor:W}),0<o.data_title.length&&a.extend(q.options,{title:{display:!0,text:o.data_title,padding:2,fontColor:W}}),1==C&&a.extend(q.options,{legend:{display:!0,labels:{boxWidth:9,padding:5,usePointStyle:!0,fontColor:W}}});var c=o.y_data.split(/[;,]+/).length,d=Chart.helpers.color;if(1==O)for(var e=o.data_color.split(","),f=0;f<c;f++)S.push(e[f%Object.keys(e).length]),T.push(d(e[f%Object.keys(e).length]).alpha(M).rgbString());else if(1==N)S=randomColor({count:c,hue:"random",luminosity:"bright",format:"rgba",alpha:1}),T=S.map(function(a){return a.replace(/[\d\.]+\)$/g,M+")")});else for(var f=0;f<c;f++)S.push(p[f%Object.keys(p).length]),T.push(d(p[f%Object.keys(p).length]).alpha(M).rgbString())}function d(){o.x_label.split(",").length===o.y_data.split(";").length&&(0==y&&a(".chart__wrapper-swap",w).css("display","inline-block"),a.each(o.x_label.split(","),function(b,c){q.data.datasets[b]={label:c,data:o.y_data.split(";")[b].split(","),backgroundColor:T[b],yAxisID:"left-y-axis"},a.extend(q.data.datasets[b],s)}),a.extend(q,{type:o.data_type}),a.extend(q.data,{labels:o.data_labels.split(",")}),a.extend(q.options.tooltips,{bevelWidth:2,bevelHighlightColor:r.highlight,bevelShadowColor:r.shadow}),0!=Q&&a.extend(q.options.scales.yAxes[0].ticks,{callback:function(a){return a+Q}}),1==J&&(a.extend(q.options.tooltips,{itemSort:function(c,a){return a.datasetIndex-c.datasetIndex}}),a.extend(q.options.scales.xAxes[0],{stacked:!0}),a.extend(q.options.scales.yAxes[0],{stacked:!0}))),1==L&&a.extend(q.options.scales.yAxes[0],{ticks:{suggestedMax:100}})}function e(){o.y_data.split(";").length===o.x_label.split(",").length&&(a(".chart__wrapper-swap",w).css("display","inline-block"),a.each(o.x_label.split(","),function(b,c){q.data.datasets[b]={label:c,data:o.y_data.split(";")[b].split(","),order:0,type:"line",lineTension:.2,fill:0===b?"origin":"-1",borderColor:S[b],backgroundColor:T[b],yAxisID:"left-y-axis",steppedLine:!(1!=K)},a.extend(q.data.datasets[b],t)}),a.extend(q,{type:o.data_type}),a.extend(q.data,{labels:o.data_labels.split(",")}),0!=Q&&a.extend(q.options.scales.yAxes[0].ticks,{callback:function(a){return a+Q}}),1==J&&(a.extend(q.options.tooltips,{itemSort:function(c,a){return a.datasetIndex-c.datasetIndex}}),a.extend(q.options.scales.yAxes[0],{stacked:!0})))}function f(){o.x_label.split(",").length===o.y_data.split(";").length&&(a.each(o.x_label.split(","),function(b,c){var d=o.y_data.split(";")[b].split(","),e=d.reduce(function(c,a){return parseFloat(c)+parseFloat(a)},0);q.data.datasets[b]={label:c,data:d,sumvalue:e,backgroundColor:T},a.extend(q.data.datasets[b],u)}),a.extend(q,{type:o.data_type}),a.extend(q.data,{labels:o.data_labels.split(",")}),a.extend(q.options,{cutoutPercentage:"pie"===o.data_type?0:40}),1<o.x_label.split(",").length&&a.extend(q.options.tooltips,{mode:"nearest"}),1==H&&a.extend(q.options.layout,{padding:{left:0,right:0,top:5,bottom:30}}),a.extend(q.options.scales.xAxes[0],{display:!1}),a.extend(q.options.scales.yAxes[0],{display:!1}))}function g(){if(o.x_label.split(",").length===o.y_data.split(";").length){a.each(o.x_label.split(","),function(b,c){var d=o.y_data.split(";")[b].split(","),e=d.reduce(function(c,a){return parseFloat(c)+parseFloat(a)},0);q.data.datasets[b]={label:c,data:d,sumvalue:e,backgroundColor:T},a.extend(q.data.datasets[b],u)}),a.extend(q,{type:o.data_type}),a.extend(q.data,{labels:o.data_labels.split(",")});var b=q.data.datasets[0].data.reduce(function(c,a){return parseFloat(c)+parseFloat(a)},0);a.extend(q.data.datasets[0],{sumvalue:b}),a.extend(q.options,{layout:{padding:{left:0,right:0,top:5,bottom:5}},scale:{display:!0,gridLines:{color:X},ticks:{beginAtZero:!0},pointLabels:{fontColor:W}}}),a.extend(q.options.scales.xAxes[0],{display:!1}),a.extend(q.options.scales.yAxes[0],{display:!1})}}function h(){o.x_label.split(",").length===o.y_data.split(";").length&&(a.each(o.x_label.split(","),function(b,c){q.data.datasets[b]={label:c,data:o.y_data.split(";")[b].split(","),borderColor:S[b],backgroundColor:T[b]},a.extend(q.data.datasets[b],t)}),a.extend(q,{type:o.data_type}),a.extend(q.data,{labels:o.data_labels.split(",")}),a.extend(q.options,{scale:{display:!0,gridLines:{color:X},angleLines:{color:X},ticks:{beginAtZero:!0},pointLabels:{fontColor:W}}}),a.extend(q.options.scales.xAxes[0],{display:!1}),a.extend(q.options.scales.yAxes[0],{display:!1}))}function i(){var b=q.data.datasets.length;q.data.datasets[b]={label:o.y2_label,data:o.y2_data.split(","),order:1==z?-1:z,type:"line",fill:!1,lineTension:0,borderColor:S[b],yAxisID:"left-y-axis"},a.extend(q.data.datasets[b],t),1==A&&(a.extend(q.options.scales.yAxes[1],{display:!0,ticks:{display:!0,beginAtZero:!0,fontColor:W},gridLines:1==F?{display:!0,color:X}:{display:!1},scaleLabel:""===o.y2_title?{display:!1}:{display:!0,labelString:o.y2_title,fontColor:W}}),0!=R&&a.extend(q.options.scales.yAxes[1].ticks,{callback:function(a){return a+R}}),a.extend(q.data.datasets[b],{yAxisID:"right-y-axis"}))}function j(){var b=Chart.helpers.color;a.extend(q.options.plugins.datalabels,{display:function(a){return a.chart.width>460},backgroundColor:function(a){var c=a.dataset.backgroundColor?a.dataset.backgroundColor:a.dataset.borderColor,d=Array.isArray(c)?b(c[a.dataIndex]).alpha("1").rgbString():b(c).alpha("1").rgbString();return d},borderColor:"white",borderRadius:8,borderWidth:2,color:"white",font:{size:12,weight:"bold"},padding:3,anchor:function(a){var b=a.dataset,c=b.data[a.dataIndex];return 0==H?"null":0>c?"start":"end"},align:function(a){var b=a.dataset,c=b.data[a.dataIndex];return 0==H?"null":0>c?"start":"end"},formatter:function(a,b){var c=a,d=b.dataset.sumvalue?b.dataset.sumvalue:a;return 1==I&&d!==a&&(c=(100*a/d).toFixed(1).replace(/(\.0)$/g,"")+"% "),c}})}function k(){var a=10*Math.ceil(v.scales["left-y-axis"]._startValue/10),b=10*Math.ceil(v.scales["right-y-axis"]._startValue/10),c=10*Math.ceil(v.scales["left-y-axis"]._endValue/10),d=10*Math.ceil(v.scales["right-y-axis"]._endValue/10),e=(Math.abs(a)+c)/10,f=(Math.abs(b)+d)/10;v.scales["left-y-axis"].options.ticks.min=a,v.scales["left-y-axis"].options.ticks.max=c,v.scales["left-y-axis"].options.ticks.stepSize=e,v.scales["right-y-axis"].options.ticks.min=b,v.scales["right-y-axis"].options.ticks.max=d,v.scales["right-y-axis"].options.ticks.stepSize=f,v.update()}function l(b){b.width<=460?(Chart.defaults.global.defaultFontSize=9,-1!==a.inArray(o.data_type,["radar","polarArea"])&&a.extend(b.options.scale.pointLabels,{fontSize:9}),a.extend(b.options.scales.xAxes[0].scaleLabel,{display:!1}),a.extend(b.options.scales.yAxes[0].scaleLabel,{display:!1}),b.scales["right-y-axis"]&&a.extend(b.scales["right-y-axis"].options.scaleLabel,{display:!1}),a.extend(b.options.layout,{padding:{left:0,right:0,top:0,bottom:5}}),a.extend(b.options.legend.labels,{boxWidth:6})):(-1!==a.inArray(o.data_type,["radar","polarArea"])&&a.extend(b.options.scale.pointLabels,{fontSize:P}),""!==U&&a.extend(b.options.scales.xAxes[0].scaleLabel,{display:!0}),""!==V&&a.extend(b.options.scales.yAxes[0].scaleLabel,{display:!0}),b.scales["right-y-axis"]&&""!==o.y2_title&&a.extend(b.scales["right-y-axis"].options.scaleLabel,{display:!0}),a.extend(b.options.legend.labels,{boxWidth:9})),b.update()}var m=b.find(".eac-chart"),n=m.find(".chart__wrapper"),o=n.data("settings")||{},p={0:"rgb(230, 25, 75)",1:"rgb(255, 225, 25)",2:"rgb(245, 130, 48)",3:"rgb(60, 180, 75)",4:"rgb(70, 240, 240)",5:"rgb(0, 130, 200)",6:"rgb(145, 30, 180)",7:"rgb(240, 50, 230)",8:"rgb(210, 245, 60)",9:"rgb(128, 128, 128)"},q={type:"",data:{labels:[],datasets:[{label:"",data:[],yAxisID:"left-y-axis"}]},options:{layout:{padding:{left:0,right:0,top:5,bottom:10}},plugins:{datalabels:{display:!1},style:!0},responsive:!0,animation:{duration:0},responsiveAnimationDuration:0,tooltips:{enabled:!0,mode:"index",displayColors:!0},title:{display:!1},legend:{display:!1},scales:{xAxes:[{display:!0,scaleLabel:{display:!1},gridLines:{display:!1},ticks:{display:!0,beginAtZero:!0}}],yAxes:[{display:!0,position:"left",id:"left-y-axis",scaleLabel:{display:!1},gridLines:{display:!1},ticks:{display:!0,beginAtZero:!0}},{display:!1,position:"right",id:"right-y-axis",scaleLabel:{display:!1},gridLines:{display:!1},ticks:{display:!1}}]},onResize:l,inverted:!1}},r={highlight:"rgba(255, 255, 255, 0.75)",shadow:"rgba(0, 0, 0, 0.5)",innerglow:"rgba(255, 255, 0, 0.5)",outerglow:"rgb(255, 255, 0)"},s={borderWidth:0,bevelWidth:2,bevelHighlightColor:r.highlight,bevelShadowColor:r.shadow},t={shadowOffsetX:3,shadowOffsetY:3,shadowBlur:10,shadowColor:r.shadow,pointRadius:4,pointBevelWidth:2,pointBevelHighlightColor:r.highlight,pointBevelShadowColor:r.shadow,pointHoverRadius:6,pointHoverBevelWidth:3,pointHoverInnerGlowWidth:20,pointHoverInnerGlowColor:r.innerglow,pointHoverOuterGlowWidth:20,pointHoverOuterGlowColor:r.outerglow},u={shadowOffsetX:3,shadowOffsetY:3,shadowBlur:10,shadowColor:r.shadow,bevelWidth:2,bevelHighlightColor:r.highlight,bevelShadowColor:r.shadow,hoverInnerGlowWidth:20,hoverInnerGlowColor:r.glow,hoverOuterGlowWidth:20,hoverOuterGlowColor:r.glow};if(0!==Object.keys(o).length){if(!o.x_label||!o.y_data||!o.data_labels)return void n.append("<h4 style='text-align:center;'>Some data are empty</h4>");var v,w=a("#"+o.data_rid),x=a("#"+o.data_sid),y=o.data_boolean.split(",")[0],z=o.data_boolean.split(",")[1],A=o.data_boolean.split(",")[2],B=o.data_boolean.split(",")[3],C=o.data_boolean.split(",")[4],D=o.data_boolean.split(",")[5],E=o.data_boolean.split(",")[6],F=o.data_boolean.split(",")[7],G=o.data_boolean.split(",")[8],H=o.data_boolean.split(",")[9],I=o.data_boolean.split(",")[10],J=o.data_boolean.split(",")[11],K=o.data_boolean.split(",")[12],L=o.data_boolean.split(",")[13],M=o.data_boolean.split(",")[14],N=o.data_boolean.split(",")[15],O=o.data_boolean.split(",")[16],P=parseInt(o.data_boolean.split(",")[17]),Q=o.data_boolean.split(",")[18],R=o.data_boolean.split(",")[19],S=[],T=[],U="horizontalBar"===o.data_type?o.y_title:o.x_title,V="horizontalBar"===o.data_type?o.x_title:o.y_title,W=""===o.color_legend?"#666666":o.color_legend,X=""===o.color_grid?"rgba(0, 0, 0, 0.1)":o.color_grid,Y={beforeLayout:function(b){b.legend.afterFit=function(){var c=460>=a(window).width()||0==H?0:15;-1!==a.inArray(b.config.type,["polarArea","horizontalBar"])&&(c=0),b.legend.height+=c}}};c(),-1!==a.inArray(o.data_type,["bar","horizontalBar"])&&d(),"line"===o.data_type&&e(),-1!==a.inArray(o.data_type,["pie","doughnut"])&&f(),"polarArea"===o.data_type&&g(),"radar"===o.data_type&&h(),1==y&&1<o.y2_data.split(",").length&&i(),1==G&&j();var Z=document.getElementById(o.data_sid).getContext("2d");v=new Chart(Z,{plugins:[ChartDataLabels,Y],type:q.type,data:q.data,options:q.options}),1==y&&1==A&&1==B&&k(),l(v),a("#"+o.data_did).on("click",function(){var a=document.getElementById(o.data_sid),b=a.getContext("2d");b.save(),b.globalCompositeOperation="destination-over",b.fillStyle=w.css("background-color"),b.fillRect(0,0,a.width,a.height);var c=document.getElementById(o.data_sid).toDataURL("image/png",1);this.href=c,b.restore()}),a(".chart__wrapper-swap",w).on("click",function(){var b=v.options.inverted,c=!1===b?o.data_labels.split(","):o.x_label.split(","),d=!1===b?o.x_label.split(","):o.data_labels.split(","),e=o.y_data.split(";"),f=v.data.datasets.length;for(v.data.labels=[];0<=f;)v.data.datasets.pop(),f--;v.data.labels=d,a.each(c,function(c,d){var f,g=[];f="line"!==v.config.type||(0===c?"origin":"-1"),!1===b?a.each(e,function(a,b){g.push(b.split(",")[c])}):g=e[c].split(","),v.data.datasets[c]={label:d,data:g,backgroundColor:T[c],borderColor:S[c],yAxisID:"left-y-axis",steppedLine:1==K,fill:f},-1===a.inArray(v.config.type,["bar","horizontalBar"])?a.extend(v.data.datasets[c],t):a.extend(v.data.datasets[c],s)}),a.extend(v.options,{inverted:!b}),v.update()})}}})(jQuery);