(function(a,b,c){function d(b){var d={current:!1,currentParent:!1,loaded:0,dimensions:!1,currentImageDim:{},controlPosition:0,clipAreaRatio:!1,$clipedImage:!1,$control:!1,init:function(){var f=b.find("img").slice(0,2),g=c("body");e.maxWidth=0<b.attr("data-maxWidth")?b.attr("data-maxWidth"):e.maxWidth,e.resize=b.attr("data-resize")?parseInt(b.attr("data-resize")):e.resize,d.current=c(e.layout.container),d.currentParent=b.closest(".eac-images-comparison"),d.current.on("prebuild",function(){d.dimensions=d.getImageRealSize(f.first().get(0)),b.css("display","none"),e.width||(e.width=d.current.width()),d.current.insertBefore(b),d.current.css({height:e.width/d.dimensions.width*d.dimensions.height})}),d.current.on("loaded",function(){function h(a){d.stopAnimation(d.$control),d.stopAnimation(d.$clipedImage);var b=a.pageY||a.originalEvent.touches[0].pageY,c=a.pageX||a.originalEvent.touches[0].pageX,f=!0,h=0;g.on("mousemove.diff touchmove.diff",function(a){var e=a.pageX||a.originalEvent.touches[0].pageX,g=a.pageY||a.originalEvent.touches[0].pageY;return Math.abs(g-b)>Math.abs(e-c)&&1>h?(f=!1,!0):void(f&&(d.controlPosition=e-j.left,d.clipAreaRatio=d.controlPosition/d.currentImageDim.width,d.move(d.controlPosition),h+=1))})}var i,j,k={};k.before=f.first().attr("data-title")||e.titles.before,k.after=f.last().attr("data-title")||e.titles.after,f.each(function(a){var b=c(e.layout.item),f=c(e.layout.title);b.append(c(this)),k.before&&1>a&&(f.addClass("b-diff__title_before"),b.append(f.text(k.after))),k.after&&0<a&&(f.addClass("b-diff__title_after"),b.append(f.text(k.before))),d.current.append(b)}),d.$control=c(e.layout.control),d.$clipedImage=d.current.find(".b-diff__item:last"),d.current.append(d.$control),j=d.current.offset(),d.resizeItems(e.width),i=d.$control.width(),d.controlPosition=d.currentImageDim.width/2-i/2,d.clipAreaRatio=d.controlPosition/d.currentImageDim.width,d.move(d.controlPosition),b.remove(),e.resize&&c(a).resize(function(){d.stopAnimation(d.$control),d.stopAnimation(d.$clipedImage),d.resizeItems(),d.controlPosition=d.clipAreaRatio*d.currentImageDim.width,d.move(d.controlPosition),j=d.current.offset()}),d.current.on("click",function(a){var b=a.pageX||a.originalEvent.touches[0].pageX;d.controlPosition=b-j.left,d.clipAreaRatio=d.controlPosition/d.currentImageDim.width,d.animateItems(d.controlPosition)}),d.current.on("mousedown.diff",function(a){if(1==a.which)return h(a),!1}),d.current.on("touchstart.diff",h),g.on("mouseup.diff touchend.diff mouseleave.diff touchleave.diff",function(){g.off("mousemove.diff touchmove.diff")}),f.on("dragstart",function(){return!1})}),f.each(function(){this.complete?(d.loaded+=1,1===d.loaded&&d.current.trigger("prebuild"),d.loaded==f.length&&d.current.trigger("loaded")):c(this).load(function(){d.loaded+=1,1===d.loaded&&d.current.trigger("prebuild"),d.loaded==f.length&&d.current.trigger("loaded")})})},getImageRealSize:function(a){return{width:a.naturalWidth,height:a.naturalHeight,ratio:a.naturalWidth/a.naturalHeight}},setClipArea:function(a){d.$clipedImage.css("clip","rect(0, "+a+"px,"+d.currentImageDim.height+"px, 0)")},moveControl:function(a){d.$control.css({left:a})},move:function(a){var b=d.$control.width();0>=a?a=0:a>=d.currentImageDim.width-b&&(a=d.currentImageDim.width-b),d.moveControl(a-e.controlSpace),d.setClipArea(a)},resizeItems:function(a){var b,c;c=a||d.current.width(),d.dimensions.width<=c&&(c=d.dimensions.width),"auto"!=e.maxWidth&&(c=e.maxWidth<c?e.maxWidth:c),b=c/d.dimensions.width,d.currentImageDim.width=b*d.dimensions.width,d.currentImageDim.height=b*d.dimensions.height,d.current.find(".b-diff__item").css({width:d.currentImageDim.width,height:d.currentImageDim.height}),d.current.css("height",d.currentImageDim.height),d.$control.css("height",d.currentImageDim.height)},animateItems:function(a){d.$control.css({"-webkit-transition":"left .3s ease-in-out",transition:"left .3s ease-in-out"}),d.$clipedImage.css({"-webkit-transition":"all .3s ease-in-out",transition:"all .3s ease-in-out"}),d.move(a)},stopAnimation:function(a){a.css({"-webkit-transition":"",transition:""})}};d.init()}var e={controlSpace:18,maxWidth:"auto",width:!1,resize:!0,titles:{before:"",after:""},layout:{container:"<div class=\"b-diff\"></div>",item:"<div class=\"b-diff__item\"></div>",control:"<div class=\"b-diff__control\"><div class=\"b-diff__line\"></div><div class=\"b-diff__arrow b-diff__arrow_left\"></div><div class=\"b-diff__arrow b-diff__arrow_right\"></div></div>",title:"<div class=\"b-diff__title\"></div>"}};c.fn.simpleImageDiff=function(a){c.extend(e,a||{}),this.each(function(){d(c(this))})}})(window,document,jQuery);