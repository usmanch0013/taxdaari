(function(a){"use strict";window.widgetInstagramSearch=function(b){function c(b){j.hide();var c=b,e=n+"search_"+f.val().replace(/\s+/g,"").toLocaleLowerCase()+".json";if(sessionStorage&&!sessionStorage.getItem(e))try{sessionStorage.setItem(e,JSON.stringify(b))}catch(a){console.log("EAC sessionStorage: d\xE9passement de quota!")}n==="user"?(d="https://www.instagram.com/",c.sort(sort_by("position",!1,parseInt))):n==="hashtag"?(d="https://www.instagram.com/explore/tags/",c.sort(sort_by("media_count_sort",!0,parseInt))):(d="https://www.instagram.com/explore/locations/",c.sort(sort_by("position",!1,parseInt))),k.isotope(v),a.each(c,function(b,c){var e=a("<div/>",{class:"insta-search__item"}),f=a("<div/>",{class:"insta-search__item-content "+l.data_style});if(n==="user"){var g="<div class=\"insta-search__item-image\"><a href=\""+d+c.username+"/\" target=\"_blank\" rel=\"nofollow\"><img class=\"eac-image-loaded\" src=\""+c.profile_pic_url+"\"></a></div>";f.append(g)}else if(n==="hashtag"){var h="<div class=\"insta-search__item-image font-awesome\"><a href=\""+d+c.username+"/\" target=\"_blank\" rel=\"nofollow\"><span><i class=\"fa fa-hashtag\" aria-hidden=\"true\"></i></span></a></div>";f.append(h)}else{var i="<div class=\"insta-search__item-image font-awesome\"><a href=\""+d+c.id+"/\" target=\"_blank\" rel=\"nofollow\"><span><i class=\"fa fa-map-marker\" aria-hidden=\"true\"></i></span></a></div>";f.append(i)}var j="<div class=\"insta-search__item-description\">",m=!0===c.is_verified?"<span><i class=\"fas fa-check-circle insta-search__isverified\" aria-hidden=\"true\"></i></span>":"",o=n==="user"?"<div><i class=\"fas fa-at\" aria-hidden=\"true\"></i><a href=\""+d+c.username+"/\" target=\"_blank\" rel=\"nofollow\">"+c.username+"</a>"+m+"</div>":n==="hashtag"?"<div><i class=\"fa fa-hashtag\" aria-hidden=\"true\"></i><a href=\""+d+c.username+"/\" target=\"_blank\" rel=\"nofollow\">"+c.username+"</a></div>":"<div><i class=\"fa fa-map-marker\" aria-hidden=\"true\"></i><a href=\""+d+c.id+"/\" target=\"_blank\" rel=\"nofollow\">"+c.name+"</a></div>";(c.username||c.name)&&(j+=o),n==="user"?(c.full_name&&l.data_fullname&&(j+="<div><i class=\"fa fa-user\" aria-hidden=\"true\"></i>"+removeEmojis(c.full_name)+"</div>"),c.follower_count&&l.data_followers&&(j+="<div><i class=\"fa fa-users\" aria-hidden=\"true\"></i>"+c.follower_count+"</div>"),c.byline&&l.data_byline&&(j+="<div><i class=\"fa fa-users\" aria-hidden=\"true\"></i>"+c.byline+"</div>"),l.data_private&&(j+="<div><i class=\"fa fa-user-secret\" aria-hidden=\"true\"></i>"+c.is_private_fill+"</div>"),c.id&&l.data_id&&(j+="<div><i class=\"fa fa-indent\" aria-hidden=\"true\"></i>"+c.id+"</div>"),0<p.length&&!1==c.is_private&&(j+="<div class=\"insta-search__sendto-user\" data-sendto=\""+c.username+"\"><i class=\"fa fa-paper-plane-o\" aria-hidden=\"true\"></i><span>Send to User component</span></div>")):n==="hashtag"?(c.media_count&&l.data_pub&&(j+="<div><i class=\"fas fa-camera\" aria-hidden=\"true\"></i>"+c.media_count+"</div>"),c.search_result_subtitle&&l.data_publang&&(j+="<div><i class=\"fas fa-camera\" aria-hidden=\"true\"></i>"+c.search_result_subtitle+"</div>"),0<r.length&&(j+="<div class=\"insta-search__sendto-explore\" data-sendto=\""+c.username+"\"><i class=\"fa fa-paper-plane-o\" aria-hidden=\"true\"></i><span>Send to Hashtag component</span></div>")):(c.city&&l.data_city&&(j+="<div><i class=\"fa fa-location-arrow\" aria-hidden=\"true\"></i>"+c.city+"</div>"),c.address&&l.data_address&&(j+="<div><i class=\"fa fa-road\" aria-hidden=\"true\"></i>"+c.address+"</div>"),c.id&&l.data_placeid&&(j+="<div><i class=\"fa fa-indent\" aria-hidden=\"true\"></i>"+c.id+"</div>"),0<t.length&&(j+="<div class=\"insta-search__sendto-location\" data-sendto=\""+c.id+"\" data-option=\""+c.name+"\"><i class=\"fa fa-paper-plane-o\" aria-hidden=\"true\"></i><span>Send to Location component</span></div>")),j+="</div>",f.append(j),e.append(f),k.append(e).isotope("appended",e)}),k.imagesLoaded(function(){k.isotope("layout")}),u=!u}var d,e=b.find(".eac-insta-search"),f=b.find("#insta-search__item-name"),g=b.find("#insta-search__read-button"),h=b.find(".insta-search__header"),i=b.find(".insta-search__error"),j=b.find("#insta-search__loader-wheel"),k=b.find(".insta-search"),l=k.data("settings")||{},m={},n="",o=a(document).find(".insta-user__options-items"),p=a(document).find("#insta-user__item-name"),q=a(document).find(".insta-explore__options-items"),r=a(document).find("#insta-explore__item-name"),s=a(document).find(".insta-location__options-items"),t=a(document).find("#insta-location__item-name"),u=!1,v={itemSelector:".insta-search__item",percentPosition:!0,masonry:{columnWidth:".insta-search__item-sizer",horizontalOrder:!0},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}};m=new ajaxCallFeed,n=a("input[name=\"insta-search__radio\"]:checked").val(),a("input[name=\"insta-search__radio\"]").on("click",function(){n=a("input[name=\"insta-search__radio\"]:checked").val(),a(".insta-search__item",k).remove(),h.add(i).html(""),u&&(k.isotope("destroy"),u=!u)}),f.on("keyup",function(a){13===a.which&&(a.preventDefault(),f.blur(),g.click())}),g.on("click",async function(b){if(b.preventDefault(),a(".insta-search__item",k).remove(),h.add(i).html(""),u&&(k.isotope("destroy"),u=!u),0!==f.val().length){var d=f.val().trim(),e=n+"search_"+f.val().replace(/\s+/g,"").toLocaleLowerCase()+".json";j.show();var g=!!(sessionStorage&&sessionStorage.getItem(e))&&sessionStorage.getItem(e);if(g)c(JSON.parse(g));else{var l=await w(n,d);if(!1==l||0===Object.keys(l).length)return j.hide(),i.html("<span>Unknown key:: "+d+"</span>"),!1;var m=[];"user"===n?a.each(l,function(a,b){m.push({position:b.position,id:b.user.pk,username:b.user.username,full_name:b.user.full_name,is_private:b.user.is_private,is_private_fill:!0===b.user.is_private?"Private account":"Public account",is_verified:b.user.is_verified,follower_count:0,follower_count_sort:0,byline:0,profile_pic_url:b.user.profile_pic_url})}):"hashtag"===n?a.each(l,function(a,b){m.push({position:b.position,username:b.hashtag.name,media_count:b.hashtag.media_count,media_count_sort:b.hashtag.media_count,search_result_subtitle:b.hashtag.search_result_subtitle})}):a.each(l,function(a,b){m.push({position:b.position,id:b.place.location.pk,name:b.place.location.name,short_name:b.place.location.short_name,lng:b.place.location.lng,lat:b.place.location.lat,address:b.place.location.address,city:b.place.location.city,external_source:b.place.location.external_source,facebook_places_id:b.place.location.facebook_places_id,title:b.place.location.title,subtitle:b.place.location.subtitle,slug:b.place.location.slug})}),c(m)}}}),e.on("click touch",".insta-search__sendto-user",function(){var b=a(this).attr("data-sendto").trim();return 0<b.length&&(p.val(b),o.append("<option value=\""+b+"\" selected=\"selected\">"+b.replace(/[\.,;:\'\"\*\(\)]/g," ")+"</option>"),a("html, body").animate({scrollTop:p.offset().top-90},1e3),p.change()),!1}),e.on("click touch",".insta-search__sendto-explore",function(){var b=a(this).attr("data-sendto").trim();return 0<b.length&&(r.val(b),q.append("<option value=\""+b+"\" selected=\"selected\">"+b.replace(/[\.,;:\'\"\*\(\)]/g,"")+"</option>"),a("html, body").animate({scrollTop:r.offset().top-90},1e3),r.change()),!1}),e.on("click touch",".insta-search__sendto-location",function(){var b=a(this).attr("data-sendto").trim(),c=a(this).attr("data-option").replace(/[\.,;:\'\"\*\(\)]/g,"").trim();return 0<b.length&&(t.val(b),s.append("<option value=\""+b+"\" selected=\"selected\">"+c+"</option>"),a("html, body").animate({scrollTop:t.offset().top-90},1e3),t.change()),!1});var w=async function(a,b){var c="https://www.instagram.com/web/search/topsearch/?context={context}&query={keyword}".replace("{context}",a),d=c.replace("{keyword}",b),e=!1,f=new Headers({Accept:"application/json;charset=utf-8","Content-Type":"application/json;charset=utf-8"});return await fetch(d,f).then(function(a){if(400<=a.status&&600>a.status)throw new Error("HTTP Error::"+a.status);return a.json()}).then(function(b){e="user"===a?b.users:"hashtag"===a?b.hashtags:b.places}).catch(function(a){console.log(a)}),e}}})(jQuery);